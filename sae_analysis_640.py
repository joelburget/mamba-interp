import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

data = pd.DataFrame.from_records(
    [
        {
            "sparsity": 0.004,
            "relative size": 2,
            "mse_loss": 0.4560200870037079,
            "sparsity_loss": 24.837684631347656,
            "l0": 17.9920654296875,
            "percent_alive": 0.890625,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 6.0562357902526855,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8170412902438409,
        },
        {
            "sparsity": 0.004,
            "relative size": 4,
            "mse_loss": 0.45182064175605774,
            "sparsity_loss": 25.69658660888672,
            "l0": 19.4276123046875,
            "percent_alive": 0.7699218988418579,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 6.187247276306152,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7945965520923117,
        },
        {
            "sparsity": 0.004,
            "relative size": 8,
            "mse_loss": 0.4450293779373169,
            "sparsity_loss": 26.234241485595703,
            "l0": 21.3673095703125,
            "percent_alive": 0.6441406011581421,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 6.268454074859619,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7806842961171929,
        },
        {
            "sparsity": 0.004,
            "relative size": 16,
            "mse_loss": 0.4460834562778473,
            "sparsity_loss": 26.352399826049805,
            "l0": 21.4638671875,
            "percent_alive": 0.537402331829071,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 6.324872970581055,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7710186753429253,
        },
        {
            "sparsity": 0.004,
            "relative size": 32,
            "mse_loss": 0.4369668662548065,
            "sparsity_loss": 26.412872314453125,
            "l0": 24.2745361328125,
            "percent_alive": 0.5094238519668579,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 6.33740758895874,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7688712588392939,
        },
        {
            "sparsity": 0.006,
            "relative size": 2,
            "mse_loss": 0.5513176918029785,
            "sparsity_loss": 15.344076156616211,
            "l0": 6.6639404296875,
            "percent_alive": 0.946093738079071,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 6.764604091644287,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6956844419359801,
        },
        {
            "sparsity": 0.006,
            "relative size": 4,
            "mse_loss": 0.5465046763420105,
            "sparsity_loss": 15.565896034240723,
            "l0": 6.9276123046875,
            "percent_alive": 0.84375,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 7.005383014678955,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6544344718553811,
        },
        {
            "sparsity": 0.006,
            "relative size": 8,
            "mse_loss": 0.5352703928947449,
            "sparsity_loss": 16.222698211669922,
            "l0": 7.7880859375,
            "percent_alive": 0.663867175579071,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 7.263855934143066,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6101531865162797,
        },
        {
            "sparsity": 0.006,
            "relative size": 16,
            "mse_loss": 0.5307828783988953,
            "sparsity_loss": 16.5367431640625,
            "l0": 8.3255615234375,
            "percent_alive": 0.5411132574081421,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 7.335106372833252,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.5979466427409488,
        },
        {
            "sparsity": 0.006,
            "relative size": 32,
            "mse_loss": 0.5301173329353333,
            "sparsity_loss": 17.205734252929688,
            "l0": 9.451904296875,
            "percent_alive": 0.5367676019668579,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 7.462226867675781,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.5761685047594517,
        },
        {
            "sparsity": 0.008,
            "relative size": 2,
            "mse_loss": 0.6533512473106384,
            "sparsity_loss": 7.540853500366211,
            "l0": 3.2120361328125,
            "percent_alive": 0.987500011920929,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 8.940444946289062,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.3229218719276451,
        },
        {
            "sparsity": 0.008,
            "relative size": 4,
            "mse_loss": 0.624093770980835,
            "sparsity_loss": 9.542768478393555,
            "l0": 3.7333984375,
            "percent_alive": 0.9019531011581421,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 7.829512596130371,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.5132455332682908,
        },
        {
            "sparsity": 0.008,
            "relative size": 8,
            "mse_loss": 0.6245534420013428,
            "sparsity_loss": 9.975932121276855,
            "l0": 4.17431640625,
            "percent_alive": 0.7486327886581421,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 9.215415954589844,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.2758141528528894,
        },
        {
            "sparsity": 0.008,
            "relative size": 16,
            "mse_loss": 0.6166289448738098,
            "sparsity_loss": 9.969945907592773,
            "l0": 4.408447265625,
            "percent_alive": 0.576855480670929,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 9.752141952514648,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.18386286792796241,
        },
        {
            "sparsity": 0.008,
            "relative size": 32,
            "mse_loss": 0.6169624924659729,
            "sparsity_loss": 10.709678649902344,
            "l0": 6.1121826171875,
            "percent_alive": 0.538134753704071,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 9.9502534866333,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.14992262618246988,
        },
        {
            "sparsity": 0.01,
            "relative size": 2,
            "mse_loss": 0.7335248589515686,
            "sparsity_loss": 2.6276755332946777,
            "l0": 2.2371826171875,
            "percent_alive": 1.0,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 10.409850120544434,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.07118505580448226,
        },
        {
            "sparsity": 0.01,
            "relative size": 4,
            "mse_loss": 0.7167914509773254,
            "sparsity_loss": 4.168965816497803,
            "l0": 2.35009765625,
            "percent_alive": 0.9722656011581421,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 9.542573928833008,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.21976582237997336,
        },
        {
            "sparsity": 0.01,
            "relative size": 8,
            "mse_loss": 0.7140644192695618,
            "sparsity_loss": 4.560460567474365,
            "l0": 2.4862060546875,
            "percent_alive": 0.828320324420929,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 14.054377555847168,
            "loss_zero": 10.825362205505371,
            "percent_recovered": -0.5531912216926727,
        },
        {
            "sparsity": 0.01,
            "relative size": 16,
            "mse_loss": 0.6985983848571777,
            "sparsity_loss": 5.607336044311523,
            "l0": 2.5601806640625,
            "percent_alive": 0.580371081829071,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 16.051700592041016,
            "loss_zero": 10.825362205505371,
            "percent_recovered": -0.8953703229440919,
        },
        {
            "sparsity": 0.01,
            "relative size": 32,
            "mse_loss": 0.6703013777732849,
            "sparsity_loss": 6.959714889526367,
            "l0": 3.76171875,
            "percent_alive": 0.500732421875,
            "loss_original": 4.988293170928955,
            "loss_reconstructed": 14.56882095336914,
            "loss_zero": 10.825362205505371,
            "percent_recovered": -0.6413250769674038,
        },
    ]
)


def plot_all_values(data):
    metrics = ["mse_loss", "sparsity_loss", "percent_alive", "percent_recovered"]
    fig, axes = plt.subplots(2, 2, figsize=(20, 16))  # 2x2 subplot grid

    for ax, metric in zip(axes.flatten(), metrics):
        pivot_table = data.pivot(
            index="sparsity", columns="relative size", values=metric
        )
        sns.heatmap(pivot_table, cmap="coolwarm", cbar_kws={"label": metric}, ax=ax)
        ax.set_title(metric)
        ax.set_xlabel("Relative Size")
        ax.set_ylabel("Sparsity")

    plt.tight_layout()
    # plt.show()
    fig.savefig("heatmap-640.png")


# Plotting all heatmaps
plot_all_values(data)
