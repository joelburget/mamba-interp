import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

data = pd.DataFrame.from_records(
    [
        {
            "sparsity": 0.004,
            "relative size": 2,
            "mse_loss": 0.23511262238025665,
            "sparsity_loss": 27.988801956176758,
            "l0": 66.4189453125,
            "percent_alive": 1.0,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 5.635042667388916,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.9533343130983252,
        },
        {
            "sparsity": 0.004,
            "relative size": 4,
            "mse_loss": 0.21848754584789276,
            "sparsity_loss": 29.329437255859375,
            "l0": 80.4625244140625,
            "percent_alive": 0.9898437261581421,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 5.663871765136719,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.948039115394829,
        },
        {
            "sparsity": 0.004,
            "relative size": 8,
            "mse_loss": 0.21547208726406097,
            "sparsity_loss": 29.557994842529297,
            "l0": 83.2169189453125,
            "percent_alive": 0.921093761920929,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 5.789583683013916,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.9249489214293872,
        },
        {
            "sparsity": 0.004,
            "relative size": 16,
            "mse_loss": 0.21566161513328552,
            "sparsity_loss": 29.917757034301758,
            "l0": 85.5289306640625,
            "percent_alive": 0.835156261920929,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 5.928009510040283,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8995234943908162,
        },
        {
            "sparsity": 0.004,
            "relative size": 32,
            "mse_loss": 0.21326233446598053,
            "sparsity_loss": 30.56484031677246,
            "l0": 91.562255859375,
            "percent_alive": 0.6830078363418579,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 5.939925670623779,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8973347881500519,
        },
        {
            "sparsity": 0.006,
            "relative size": 2,
            "mse_loss": 0.31104692816734314,
            "sparsity_loss": 17.64859390258789,
            "l0": 24.826904296875,
            "percent_alive": 0.996874988079071,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 5.975515365600586,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8907978346609792,
        },
        {
            "sparsity": 0.006,
            "relative size": 4,
            "mse_loss": 0.2997274100780487,
            "sparsity_loss": 18.39154815673828,
            "l0": 29.354248046875,
            "percent_alive": 0.93359375,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.155395984649658,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8577581797531273,
        },
        {
            "sparsity": 0.006,
            "relative size": 8,
            "mse_loss": 0.2941877841949463,
            "sparsity_loss": 18.699037551879883,
            "l0": 31.3824462890625,
            "percent_alive": 0.86328125,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.419218063354492,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8093005388824233,
        },
        {
            "sparsity": 0.006,
            "relative size": 16,
            "mse_loss": 0.29378315806388855,
            "sparsity_loss": 18.78716468811035,
            "l0": 32.0440673828125,
            "percent_alive": 0.707812488079071,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.576273441314697,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7804533205625229,
        },
        {
            "sparsity": 0.006,
            "relative size": 32,
            "mse_loss": 0.29062598943710327,
            "sparsity_loss": 18.85981559753418,
            "l0": 34.1478271484375,
            "percent_alive": 0.6361328363418579,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.597949028015137,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7764720472697488,
        },
        {
            "sparsity": 0.008,
            "relative size": 2,
            "mse_loss": 0.36524084210395813,
            "sparsity_loss": 12.527054786682129,
            "l0": 11.706787109375,
            "percent_alive": 0.9765625,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.271820068359375,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.8363739329728639,
        },
        {
            "sparsity": 0.008,
            "relative size": 4,
            "mse_loss": 0.36117252707481384,
            "sparsity_loss": 12.874473571777344,
            "l0": 12.33349609375,
            "percent_alive": 0.913281261920929,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.62713098526001,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7711120379368742,
        },
        {
            "sparsity": 0.008,
            "relative size": 8,
            "mse_loss": 0.3562246859073639,
            "sparsity_loss": 13.3036470413208,
            "l0": 13.906982421875,
            "percent_alive": 0.826953113079071,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 7.07338809967041,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6891455585115887,
        },
        {
            "sparsity": 0.008,
            "relative size": 16,
            "mse_loss": 0.35135650634765625,
            "sparsity_loss": 13.882412910461426,
            "l0": 15.793701171875,
            "percent_alive": 0.6669921875,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 7.278017997741699,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6515600684691073,
        },
        {
            "sparsity": 0.008,
            "relative size": 32,
            "mse_loss": 0.35019877552986145,
            "sparsity_loss": 13.83349609375,
            "l0": 16.263671875,
            "percent_alive": 0.5672851800918579,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 7.397373676300049,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6296373596653058,
        },
        {
            "sparsity": 0.01,
            "relative size": 2,
            "mse_loss": 0.4193704426288605,
            "sparsity_loss": 9.591564178466797,
            "l0": 6.7933349609375,
            "percent_alive": 0.981249988079071,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 6.741879463195801,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.7500355588128752,
        },
        {
            "sparsity": 0.01,
            "relative size": 4,
            "mse_loss": 0.4158356189727783,
            "sparsity_loss": 9.81568717956543,
            "l0": 6.7093505859375,
            "percent_alive": 0.909375011920929,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 7.031552791595459,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.6968296778406586,
        },
        {
            "sparsity": 0.01,
            "relative size": 8,
            "mse_loss": 0.40382009744644165,
            "sparsity_loss": 10.279176712036133,
            "l0": 8.0836181640625,
            "percent_alive": 0.7816406488418579,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 7.6698527336120605,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.5795896442927579,
        },
        {
            "sparsity": 0.01,
            "relative size": 16,
            "mse_loss": 0.3982190489768982,
            "sparsity_loss": 10.54012680053711,
            "l0": 8.80859375,
            "percent_alive": 0.6494140625,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 8.03176212310791,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.5131157717873926,
        },
        {
            "sparsity": 0.01,
            "relative size": 32,
            "mse_loss": 0.39406251907348633,
            "sparsity_loss": 10.94758415222168,
            "l0": 9.908935546875,
            "percent_alive": 0.548144519329071,
            "loss_original": 5.380976676940918,
            "loss_reconstructed": 8.200323104858398,
            "loss_zero": 10.825362205505371,
            "percent_recovered": 0.48215525643334245,
        },
    ]
)


def plot_all_values(data):
    metrics = ["mse_loss", "sparsity_loss", "percent_alive", "percent_recovered"]
    fig, axes = plt.subplots(2, 2, figsize=(20, 16))  # 2x2 subplot grid

    for ax, metric in zip(axes.flatten(), metrics):
        pivot_table = data.pivot(
            index="sparsity", columns="relative size", values=metric
        )
        sns.heatmap(pivot_table, cmap="coolwarm", cbar_kws={"label": metric}, ax=ax)
        ax.set_title(metric)
        ax.set_xlabel("Relative Size")
        ax.set_ylabel("Sparsity")

    plt.tight_layout()
    # plt.show()
    fig.savefig("heatmap-320.png")


# Plotting all heatmaps
plot_all_values(data)
